# 舆情分析系统 - 功能总结

## ✅ 已实现的功能

### 1. 数据采集
- ✅ Reddit 数据采集
- ✅ YouTube 数据采集（含字幕）
- ✅ Twitter 数据采集
- ✅ 可配置采集数量
- ✅ 支持中英文关键词

### 2. AI 分析
- ✅ 情感分析（0-100分）
- ✅ 核心观点提取
- ✅ 争议点总结
- ✅ AI 深度摘要
- ✅ 思维导图生成（带节点情感标注）
- ✅ 支持中英文分析

### 3. 思维导图可视化
- ✅ 按情感分组展示（正面/中性/负面）
- ✅ 每个节点独立的情感颜色
- ✅ 树状层级结构
- ✅ 主题适配（亮色/暗色）
- ✅ 清晰的视觉层次

### 4. 定时任务
- ✅ 用户订阅关键词
- ✅ 灵活的时间间隔设置（时/分/秒）
- ✅ 最小间隔：10秒
- ✅ 自动定期采集和分析
- ✅ 后端每分钟检查一次
- ✅ 详细的执行日志

### 5. 负面舆情报警
- ✅ 情感得分 < 30 自动报警
- ✅ 报警记录保存到数据库
- ✅ 前端通知图标显示未读数量
- ✅ 点击查看报警详情

### 6. 任务状态跟踪
- ✅ 后端跟踪任务执行状态
- ✅ 实时进度信息
- ✅ 任务状态 API
- ✅ 前端自动轮询检测
- ✅ 任务完成后自动刷新

### 7. 前端进度提示
- ✅ 启动任务时显示进度
- ✅ 实时更新执行状态
- ✅ 加载动画
- ✅ 任务完成提示

### 8. 自动刷新
- ✅ 手动采集任务完成后自动刷新
- ✅ 定时任务执行后数据自动更新
- ✅ 每3秒检查一次状态
- ✅ 最多轮询2分钟

### 9. 主题切换
- ✅ 亮色主题
- ✅ 暗色主题
- ✅ 跟随系统
- ✅ 所有组件完美适配

### 10. 数据管理
- ✅ 清空所有数据功能
- ✅ 删除订阅任务
- ✅ 查看源数据
- ✅ 数据持久化

## 📊 数据流程

```
用户创建订阅
    ↓
后端每分钟检查
    ↓
触发采集任务
    ↓
采集数据（Reddit/YouTube/Twitter）
    ↓
数据清洗
    ↓
AI 分析（情感/观点/摘要/思维导图）
    ↓
检查情感得分
    ↓
< 30 → 创建报警
    ↓
更新 next_run
    ↓
前端自动刷新
```

## 🎯 使用场景

### 场景1：快速测试
```
1. 创建1分钟间隔的订阅
2. 等待1-2分钟
3. 查看自动更新的数据
4. 验证报警功能
```

### 场景2：实时监控
```
1. 创建5-10分钟间隔的订阅
2. 系统自动定期采集
3. 负面舆情自动报警
4. 前端实时显示最新数据
```

### 场景3：长期跟踪
```
1. 创建6小时间隔的订阅
2. 系统每天采集4次
3. 累积历史数据
4. 分析舆情趋势
```

## 🧪 测试工具

### 1. 完整流程测试
```bash
python test_complete_flow.py
```
- 创建订阅
- 等待执行
- 验证数据
- 检查报警
- 自动清理

### 2. 订阅状态检查
```bash
python check_subscriptions.py
```
- 查看所有订阅
- 显示执行时间
- 计算等待时间

### 3. 数据库迁移
```bash
python migrate_subscriptions.py
```
- 升级数据库结构
- 保留现有数据

## 📝 配置说明

### 时间间隔设置
- **测试**：0时 1分 0秒（60秒）
- **开发**：0时 5分 0秒（300秒）
- **生产**：6时 0分 0秒（21600秒）

### 采集数量
- **测试**：5-10条/平台
- **正常**：30条/平台
- **深度**：50-100条/平台

### 报警阈值
- **负面舆情**：情感得分 < 30
- **可在代码中调整**

## 🔧 故障排查

### 任务没有执行
1. 检查后端日志：
   ```
   INFO:__main__:🔍 检查定时任务...
   INFO:__main__:找到 X 个待执行任务
   ```

2. 检查订阅状态：
   ```bash
   python check_subscriptions.py
   ```

3. 确认 next_run 时间正确

### 前端没有自动刷新
1. 打开浏览器开发者工具
2. 查看 Network 标签
3. 确认有 `/api/task-status` 请求
4. 检查返回的状态数据

### 进度提示不显示
1. 确认 DataProvider 正确更新状态
2. 检查 Consumer 是否正确监听
3. 查看浏览器控制台错误

## 📈 性能建议

1. **轮询间隔**：3秒（平衡实时性和性能）
2. **最大轮询次数**：40次（2分钟）
3. **定时检查间隔**：1分钟（不建议更短）
4. **采集数量**：根据需求调整，避免过大

## 🎉 核心亮点

1. **完全自动化**：创建订阅后无需人工干预
2. **实时反馈**：前端自动显示任务进度和结果
3. **智能报警**：负面舆情自动通知
4. **灵活配置**：时间间隔精确到秒
5. **可视化强**：思维导图直观展示观点分布
6. **主题完美**：亮色暗色无缝切换
7. **易于测试**：提供完整的测试工具

## 📚 相关文档

- `SCHEDULER_GUIDE.md` - 定时任务详细指南
- `TASK_STATUS_GUIDE.md` - 任务状态和自动刷新说明
- `test_complete_flow.py` - 完整流程测试脚本
- `check_subscriptions.py` - 订阅状态检查工具

## 🚀 快速开始

1. 启动后端：
   ```bash
   python -m uvicorn api:app --port 8888
   ```

2. 启动前端：
   ```bash
   cd frontend
   flutter run -d chrome
   ```

3. 创建测试订阅：
   - 关键词：AI测试
   - 间隔：0时 1分 0秒
   - 采集数量：5/5/5

4. 等待1-2分钟，观察：
   - 后端日志输出
   - 前端进度提示
   - 数据自动刷新
   - 思维导图展示

5. 运行测试脚本验证：
   ```bash
   python test_complete_flow.py
   ```

完成！🎊
