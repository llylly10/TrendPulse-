# 验证源数据更新修复

## 前提条件
1. 后端 API 正在运行（`python api.py`）
2. 前端应用正在运行（在 `frontend` 目录运行 `flutter run -d chrome`）

## 验证步骤

### 方法 1：自动化测试（推荐）

运行测试脚本：
```bash
python test_keyword_switch.py
```

这个脚本会：
1. 采集关键词 "Python" 的数据
2. 验证仪表盘和源数据都显示 "Python"
3. 采集关键词 "JavaScript" 的数据
4. 验证仪表盘和源数据都更新为 "JavaScript"

如果测试通过，说明修复成功！

### 方法 2：手动测试

1. **打开前端应用**
   - 在浏览器中打开应用
   - 应该看到仪表盘页面

2. **采集第一个关键词**
   - 点击右上角的 "+" 按钮
   - 输入关键词：`Gemini`
   - 点击"开始采集"
   - 等待任务完成（底部会显示进度）

3. **检查仪表盘**
   - 仪表盘应该显示 "Gemini" 的数据
   - 查看思维导图核心主题是否为 "Gemini"
   - 查看关键观点和摘要是否与 "Gemini" 相关

4. **检查源数据**
   - 点击底部导航栏的"源数据"标签
   - 页面顶部应该显示：`当前关键词: Gemini`
   - 所有数据卡片的内容应该与 "Gemini" 相关

5. **切换到第二个关键词**
   - 返回仪表盘（点击底部导航栏的"仪表盘"）
   - 点击右上角的 "+" 按钮
   - 输入关键词：`ChatGPT`
   - 点击"开始采集"
   - 等待任务完成

6. **验证数据更新**
   - 仪表盘应该显示 "ChatGPT" 的数据
   - 思维导图核心主题应该变为 "ChatGPT"
   - 点击"源数据"标签
   - **关键验证点**：页面顶部应该显示 `当前关键词: ChatGPT`
   - 所有数据卡片应该显示 "ChatGPT" 相关内容
   - **不应该**看到任何 "Gemini" 的内容

7. **多次切换验证**
   - 在"仪表盘"和"源数据"之间多次切换
   - 每次切换到源数据页面，都应该显示最新的关键词数据
   - 数据应该保持一致

## 预期结果

✓ 源数据页面显示的关键词与仪表盘一致
✓ 切换标签页时数据自动刷新
✓ 不需要手动点击刷新按钮
✓ 每次采集新关键词后，所有页面都显示新数据

## 如果仍有问题

1. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签是否有错误信息

2. **检查网络请求**
   - 在开发者工具的 Network 标签
   - 切换到源数据页面时，应该看到 `/api/source-data` 请求
   - 检查响应数据中的 `keyword` 字段

3. **检查后端日志**
   - 查看运行 `api.py` 的终端
   - 应该看到数据查询的日志

4. **强制刷新**
   - 在浏览器中按 Ctrl+Shift+R 强制刷新
   - 清除浏览器缓存后重试

## 技术细节

修复的核心是将页面从"缓存模式"改为"动态创建模式"：

- **之前**：页面创建一次后保存在内存中，切换时不重新加载
- **现在**：每次切换标签都重新创建页面，触发 `initState()` 和数据刷新

这确保了用户每次查看源数据页面时，都能看到最新的数据。
